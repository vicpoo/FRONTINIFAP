<!-- Recomendaciones.component.html -->
<!-- Recomendaciones.component.html -->
<div class="p-6 space-y-6">

  <!-- Botón agregar -->
  <h1 class="text-3xl font-bold px-4 py-2 inline-block">
    RECOMENDACIONES
  </h1>
  <div class="flex justify-start">
    <button 
      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
      (click)="abrirModal()">
      AGREGAR NUEVA RECOMENDACIÓN
    </button>
  </div>

  <!-- Encabezado -->
  <h2 class="text-2xl font-bold">RECOMENDACIONES CREADAS</h2>

  <!-- Controles de orden y búsqueda -->
  <div class="flex gap-4 items-center">
    <select [(ngModel)]="orden" (change)="aplicarFiltro()"
      class="border px-3 py-2 rounded bg-white">
      <option value="recientes">ORDEN: MÁS RECIENTES</option>
      <option value="antiguos">ORDEN: MÁS ANTIGUOS</option>
    </select>

    <input [(ngModel)]="filtroMunicipio" (input)="aplicarFiltro()"
      type="text" placeholder="BUSCAR POR ID DE MUNICIPIO O NOMBRE"
      class="flex-1 border px-3 py-2 rounded"/>
  </div>

  <!-- Cards -->
  <div class="space-y-6">
    <div *ngFor="let rec of recomendacionesFiltradas"
         class="border rounded-xl shadow bg-white overflow-hidden">

      <!-- Header -->
      <div class="flex items-center justify-between bg-[#6A0F36] text-white px-4 py-2">
        <img src="assets/inifap.png" alt="logo" class="h-8 w-auto"/>
        <h3 class="font-bold text-lg text-center flex-1">
          ID Municipio: {{ rec.municipio_id }}
        </h3>
        <div class="flex gap-3">
          <img src="assets/editar.png" alt="editar"
               class="h-6 w-6 cursor-pointer hover:scale-110 transition"
               (click)="abrirModal(rec)" />
          <img src="assets/borrar.png" alt="borrar"
               class="h-6 w-6 cursor-pointer hover:scale-110 transition"
               (click)="eliminar(rec)" />
        </div>
      </div>

      <!-- Cuerpo -->
      <div class="p-4 text-gray-700">
        <p>{{ rec.descripcion }}</p>
        <button 
          class="mt-3 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm"
          (click)="descargarPdf(rec.nombre_pdf)">
          Descargar PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="recomendacionesFiltradas.length === 0" class="text-center py-10 text-gray-500">
    No se encontraron recomendaciones
  </div>
</div>

<!-- Modal -->
<div *ngIf="modalAbierto"
     class="fixed inset-0  bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
  
  <div class="bg-white rounded-xl shadow-lg w-full max-w-lg p-6">
    
    <h2 class="text-xl font-bold mb-4 text-center">
      {{ esNuevo ? 'Agregar Recomendación Nutricional' : 'Editar Recomendación Nutricional' }}
    </h2>

    <!-- Formulario -->
    <form class="space-y-4" (ngSubmit)="guardarRecomendacion()">
      
      <!-- Select de municipio -->
      <div>
        <label class="block font-semibold mb-1">Municipio</label>
        <select 
          [(ngModel)]="formRecomendacion.municipio_id_FK" 
          name="municipio_id_FK"
          class="w-full border rounded px-3 py-2" 
          required>
          <option value="" disabled selected>Seleccione un municipio</option>
          <option *ngFor="let municipio of municipios" [value]="municipio.id_municipio">
            {{ municipio.nombre }} (ID: {{ municipio.id_municipio }})
          </option>
        </select>
      </div>

      <!-- Subir PDF -->
      <div>
        <label class="block font-semibold mb-1">Archivo PDF {{esNuevo ? '' : '(opcional)'}}</label>
        <input type="file" accept=".pdf" (change)="onFileSelected($event)"
          class="w-full border rounded px-3 py-2" [required]="esNuevo"/>
        <p class="text-sm text-gray-500 mt-1">Solo archivos PDF</p>
      </div>

      <!-- Texto recomendación -->
      <div>
        <label class="block font-semibold mb-1">Descripción (opcional)</label>
        <textarea [(ngModel)]="formRecomendacion.descripcion" name="descripcion"
          rows="3" class="w-full border rounded px-3 py-2" placeholder="Breve descripción de la recomendación..."></textarea>
      </div>

      <!-- Botones -->
      <div class="flex justify-end gap-4 pt-4">
        <button type="button" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded"
          (click)="cerrarModal()">
          Cancelar
        </button>
        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
          {{ esNuevo ? 'Crear' : 'Actualizar' }}
        </button>
      </div>

    </form>
  </div>
</div>